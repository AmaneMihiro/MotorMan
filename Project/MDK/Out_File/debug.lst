C251 COMPILER V5.60.0,  debug                                                              20/03/25  18:10:41  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE debug
OBJECT MODULE PLACED IN .\Out_File\debug.obj
COMPILER INVOKED BY: D:\Keil_v5\C251\BIN\C251.EXE ..\USER\src\debug.c XSMALL INTR2 WARNINGLEVEL(3) BROWSE INCDIR(..\..\L
                    -ibraries\libraries;..\..\Libraries\seekfree_libraries;..\..\Libraries\seekfree_peripheral;..\CODE;..\USER\inc;..\USER\sr
                    -c) DEBUG PRINT(.\Out_File\debug.lst) TABS(2) OBJECT(.\Out_File\debug.obj) 

stmt  level    source

    1          #include "debug.h"
    2          #include "math.h"
    3          /*************************ä½¿ç”¨è¯´æ˜****************************************
    4          æœ¬åè®®ä¸â€œVisual Scopeâ€è½¯ä»¶åè®®å…¼å®¹ï¼Œç”¨è¿‡çš„å¯ä»¥ç›´æ¥ç”¨åŸæ¥çš„ä¸‹ä½æœºåè®®å³å¯
    5          é¦–æ¬¡ä½¿ç”¨æ—¶ï¼š
    6          1.å°†â€œoutputdata.câ€å’Œâ€œoutputdata.hâ€æ·»åŠ åˆ°ä½ çš„å·¥ç¨‹ä¸­
    7          2.åœ¨â€œoutputdata.câ€ä¸­åŒ…å«ä½ åŸç¨‹åºçš„ä¸²å£å‘é€å‡½æ•°å¤´æ–‡ä»¶
    8          3.å°†uart_putchar(databuf[i]);è¯­å¥æ›¿æ¢ä¸ºä½ çš„ä¸²å£å­—èŠ‚å‘é€å‡½æ•°ï¼Œå¦‚send_char(databuf[i]);
    9          4.åœ¨ä½ çš„ç¨‹åºéœ€è¦å‘é€æ³¢å½¢æ•°æ®çš„.cæ–‡ä»¶ä¸­æ·»åŠ åŒ…å«ï¼š#include "outputdata.h"ï¼Œå¹¶åœ¨æœ¬
             -æ–‡ä»¶ä¸­è°ƒç”¨å‡½æ•°OutPut_Data(x,y,z,w);
   10            å…¶ä¸­å½¢å‚xï¼Œyï¼Œzï¼Œwå°±æ˜¯ä¼ å…¥å››ä¸ªshort int 16ä½æ•°æ®ï¼Œåˆ†åˆ«å¯¹åº”é€šé“1,2,3,4
   11          ************************************************************************/
   12          //æ­¤å¤„æ·»åŠ ä½ çš„ä¸²å£å¤´æ–‡ä»¶åŒ…å«ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼
   13          #include "zf_uart.h"
   14          //****************************ç§»æ¤**************************//
   15          
   16          void Data_Send(UARTN_enum uratn,signed short int *pst)
   17          {
   18   1          unsigned char _cnt=0; unsigned char sum = 0;
   19   1          unsigned char data_to_send[23] = {0};         //å‘é€ç¼“å­˜
   20   1          unsigned char i;
   21   1          data_to_send[_cnt++]=0xAA;
   22   1          data_to_send[_cnt++]=0xAA;
   23   1          data_to_send[_cnt++]=0x02;
   24   1          data_to_send[_cnt++]=0;
   25   1          data_to_send[_cnt++]=(unsigned char)(pst[0]>>8);  //é«˜8ä½
   26   1          data_to_send[_cnt++]=(unsigned char)pst[0];  //ä½8ä½
   27   1          data_to_send[_cnt++]=(unsigned char)(pst[1]>>8);
   28   1          data_to_send[_cnt++]=(unsigned char)pst[1];
   29   1          data_to_send[_cnt++]=(unsigned char)(pst[2]>>8);
   30   1          data_to_send[_cnt++]=(unsigned char)pst[2];
   31   1          data_to_send[_cnt++]=(unsigned char)(pst[3]>>8);
   32   1          data_to_send[_cnt++]=(unsigned char)pst[3];
   33   1          data_to_send[_cnt++]=(unsigned char)(pst[4]>>8);
   34   1          data_to_send[_cnt++]=(unsigned char)pst[4];
   35   1          data_to_send[_cnt++]=(unsigned char)(pst[5]>>8);
   36   1          data_to_send[_cnt++]=(unsigned char)pst[5];
   37   1          data_to_send[_cnt++]=(unsigned char)(pst[6]>>8);
   38   1          data_to_send[_cnt++]=(unsigned char)pst[6];
   39   1          data_to_send[_cnt++]=(unsigned char)(pst[7]>>8);
   40   1          data_to_send[_cnt++]=(unsigned char)pst[7];
   41   1          data_to_send[_cnt++]=(unsigned char)(pst[8]>>8);
   42   1          data_to_send[_cnt++]=(unsigned char)pst[8];
   43   1      
   44   1      
   45   1          data_to_send[3] = _cnt-4;
   46   1      
   47   1          sum = 0;
   48   1          for(i=0;i<_cnt;i++)
   49   1              sum += data_to_send[i];
   50   1      
   51   1          data_to_send[_cnt++] = sum;
   52   1      
   53   1              for(i=0;i<_cnt;i++)
   54   1          uart_putchar(uratn,data_to_send[i]);
   55   1      }
   56          
C251 COMPILER V5.60.0,  debug                                                              20/03/25  18:10:41  PAGE 2   

   57          //===================================================ä¸Šä½æœºç›¸å…³çš„==================================
             -========================
   58          //=======================================================================================================
             -===============
   59          /****************æ•°æ®ä¼ è¾“******************
   60          å‡½æ•°ï¼švoid datasend()
   61          å‚æ•°ï¼š  æ— 
   62          è¯´æ˜ï¼š å¯ä»¥åŒæ—¶ä¼ è¾“6ä¸ªæ•°  icm_gyro_x   icm_acc_x ICM_Real.gyro.y  ICM_Real.acc.z   
   63          å¸¸çœ‹çš„å˜é‡ï¼šicm_acc_x  icm_gyro_y  Angle  adc_date[0] Left_Adc
   64          
   65          è¿”å›å€¼ï¼šæ— 
   66          æ—¥æœŸï¼š
   67          ä½œè€…ï¼š  */
   68          void datasend()
   69          {  
   70   1         short send_data[6];                      
   71   1      
   72   1         send_data[0]= aim_speed;//left_speed; ////////ICM_Start.acc.x 
   73   1         send_data[1]= left_real_speed;//right_speed; //////////////////    MpuStart.gyro.x   Angle  
   74   1         send_data[2]= aim_speed; //////////
   75   1         send_data[3]= right_real_speed;//imu660ra_gyro_z; //
   76   1         send_data[4]= 0;//GORY_Z;
   77   1         send_data[5]= 0;
   78   1         //Data_Send(UART_4,send_data);
   79   1         Data_Send(UART_User,send_data);
   80   1      }
   81          
   82          float StrToDouble(const char *s)
   83          {
   84   1        int i = 0;
   85   1        int k = 0;
   86   1        float j;
   87   1        int flag =1;
   88   1        float result = 0.0;
   89   1        if (s[i] == '+')
   90   1        {
   91   2          i++;
   92   2        }
   93   1        if (s[i] == '-')
   94   1        {
   95   2          i++;
   96   2          flag = -1;
   97   2        }
   98   1        while (s[i] != '\0' && s[i] != '.')
   99   1        {
  100   2          j = (s[i] - '0')*1.0;
  101   2          result = result * 10 + j;
  102   2          i++;
  103   2        }
  104   1        if (s[i] == '.')
  105   1        {
  106   2          i++;
  107   2          while (s[i] != '\0'&&s[i] != ' ')
  108   2          {
  109   3            k++;
  110   3            j = s[i] - '0';
  111   3            result = result + (1.0 * j) / pow(10.0, k);   
  112   3            i++;
  113   3          }
  114   2        }
  115   1        result = flag * result;
  116   1        return result;
  117   1      }
  118          
  119          void extern_iap_write_float(double dat,uint8 num,uint8 pointnum,uint16 addr)
  120          {
C251 COMPILER V5.60.0,  debug                                                              20/03/25  18:10:41  PAGE 3   

  121   1        uint8   length;
  122   1        int8    buff[34];
  123   1        int8    start,end,point;
  124   1      
  125   1        if(0>dat)   length = zf_sprintf( &buff[0],"%f",dat);//è´Ÿæ•°
  126   1        else
  127   1        {
  128   2          length = zf_sprintf( &buff[1],"%f",dat);
  129   2          length++;
  130   2        }
  131   1        point = length - 7;         //è®¡ç®—å°æ•°ç‚¹ä½ç½®
  132   1        start = point - num - 1;    //è®¡ç®—èµ·å§‹ä½
  133   1        end = point + pointnum + 1; //è®¡ç®—ç»“æŸä½
  134   1        while(0>start)//æ•´æ•°ä½ä¸å¤Ÿ  æœ«å°¾åº”è¯¥å¡«å……ç©ºæ ¼
  135   1        {
  136   2          buff[end] = ' ';
  137   2          end++;
  138   2          start++;
  139   2        }
  140   1          
  141   1        if(0>dat)   buff[start] = '-';
  142   1        else        buff[start] = '+';
  143   1          
  144   1        buff[end] = '\0';
  145   1      
  146   1        extern_iap_write_bytes(addr,(uint8 *)buff,num+pointnum+3);
  147   1      }
  148          
  149          float iap_read_float(uint8 len, uint16 addr)
  150          {
  151   1        uint8 buf[34];
  152   1        iap_read_bytes(addr, buf, len);
  153   1        
  154   1        return StrToDouble(buf);
  155   1      }
  156          
  157          void EEROM_CanshuInit() //PIDåˆå§‹åŒ–
  158          {
  159   1      //å‘eepromå†™å…¥æ•°æ®ï¼Œåœ¨å†™å…¥çš„æ—¶å€™è®°å¾—æŠŠæ“¦é™¤eepromåŒºå‹¾ä¸Š
  160   1      //  extern_iap_write_float(30,3,1,0x00);//(30,3,1,0x00)ä¸­çš„30ä»£è¡¨è¦å†™å…¥çš„æ•°ï¼Œ3ä»£è¡¨æ•´æ•°ä½ï¼Œ
             -1ä»£è¡¨å°æ•°ä½ã€‚è¿™å¥è¯çš„æ„æ€æ˜¯æŠŠ30è½¬æ¢ä¸º"+030.0"å­˜å…¥0x00-0x06åœ°å€ä¸­ï¼Œå› ä¸º"+030.0"å å…­ä¸ªåœ°å€ï¼
             -ŒåŠ ä¸Šå­—ç¬¦ä¸²çš„ç»“æŸå­—ç¬¦'/0'ï¼Œæ‰€ä»¥å äº†ä¸ƒä¸ªåœ°å€ï¼Œæ‰€ä»¥æ˜¯0x00åˆ°0x06,ä¸‹ä¸ªæ•°æ®è¦å­˜ä»¥åˆ°0x07ä¸ºèµ·
             -å§‹åœ°å€ã€‚
  161   1      //  extern_iap_write_float(15,3,1,0x07);
  162   1      //  extern_iap_write_float(11000,5,1,0x0e);
  163   1      //  extern_iap_write_float(315,4,1,0x17);
  164   1      //  extern_iap_write_float(2.0,1,1,0x1f);
  165   1      //  extern_iap_write_float(1.5,1,1,0x24);
  166   1      //  extern_iap_write_float(680,3,1,0x29);
  167   1        
  168   1      //ä»eepromä¸­è¯»å–æ•°æ®ï¼Œè®°å¾—ä¸è¦æŠŠæ“¦é™¤eepromåŒºå‹¾ä¸Š
  169   1          //SpeedPID.Kp=iap_read_float(7,0x00);
  170   1          //iap_read_bytes(0x00,SpeedPID.Kp,2);
  171   1          //TurnPID.Ki=iap_read_float(7,0x0e);
  172   1      //  TurnPID.Kp= iap_read_float(7,0x00);//è¿™å¥è¯çš„æ„æ€æ˜¯ä»0x00åœ°å€å¼€å§‹å–å‡º7ä¸ªåœ°å€çš„æ•°æ®
             -ï¼Œä¹Ÿå°±æ˜¯0x00åˆ°0x06ã€‚
  173   1      //  TurnPID.Ki = iap_read_float(7,0x07);
  174   1      //  TurnPID.Kd = iap_read_float(9,0x0e);
  175   1          //iap_read_bytes(0x00,(uint16 *)"350",2); //aim_speed=
  176   1      //  MotorPID.I = iap_read_float(8,0x17);
  177   1      //  Stright=iap_read_float(5,0x1f);
  178   1      //  Curve=iap_read_float(5,0x24);
  179   1      //  pout0=iap_read_float(7,0x29);
  180   1      }
  181          //====================================================å±å¹•ç›¸å…³çš„=(å·²åˆ é™¤)========================
             -=====================================
C251 COMPILER V5.60.0,  debug                                                              20/03/25  18:10:41  PAGE 4   

  182          //=======================================================================================================
             -=====================
  183          //sprintf(temp," date20=%d",date);
  184          //TFTSPI_P8X8Str(0,19,temp,BLACK,WHITE);break;
  185          
  186          //==========================================================æ‹¨ç å¼€å…³åŠæŒ‰é”®ç›¸å…³==================
             -=======================================
  187          //=======================================================================================================
             -=============================
  188          
  189          //æ‹¨ç å¼€å…³å¼•è„šå®å®šä¹‰
  190          #define Switch_Pin_1       P75
  191          #define Switch_Pin_2       P76
  192          #define Switch_Pin_3       P11
  193          #define Switch_Pin_4       P61
  194          #define Switch_Pin_5       P14
  195          #define Switch_Pin_6       P15
  196          //å®šä¹‰æŒ‰é”®å¼•è„š
  197          #define KEY1    P70      
  198          #define KEY2    P71      
  199          #define KEY3    P72        
  200          #define KEY4    P73       
  201          
  202          //***************å‡½æ•°å®å®šä¹‰****(ä¸‹é¢è¿™äº›å‡½æ•°è¯·ä¿®æ”¹å®å®šä¹‰ä¸ºå¯¹åº”çš„GPIOåº“å‡½æ•°æ“ä½œ)
             -***********
  203          #define KEY_INT(key_x)           gpio_pull_set(key_x,PULLUP)//é…ç½®ä¸ºä¸Šæ‹‰è¾“å‡º   
  204          #define SWITCH_INT(switch_x)     gpio_pull_set(switch_x,PULLUP)//é…ç½®ä¸ºä¸Šæ‹‰ç”µé˜»
  205          #define READ_GPIO(Pin_X)         Pin_X
  206          #define TiaoCan_DelayMs(M_S)     delay_ms(M_S)   //å»¶æ—¶
  207          
  208          unsigned char TiaoCan=0;////////////////////////è°ƒå‚æ ‡å¿—ä½
  209          unsigned char TFT_SHOW=0;///////////////////////å±å¹•å¼€å…³
  210          unsigned char Switch1=0,Switch2=0,Switch3=0,Switch4=0,Switch5=0,Switch6=0;//æ‹¨ç 
  211          char parameter=0;//å‚æ•°é€‰æ‹©
  212          
  213          //å¼€å…³çŠ¶æ€å˜é‡
  214          uint8 key1_status = 1,key2_status = 1,key3_status = 1, key4_status = 1,key5_status = 1;
  215          //ä¸Šä¸€æ¬¡å¼€å…³çŠ¶æ€å˜é‡
  216          uint8 key1_last_status, key2_last_status, key3_last_status, key4_last_status,key5_last_status;
  217          //å¼€å…³æ ‡å¿—ä½
  218          uint8 key1_flag=0,key2_flag=0,key3_flag=0, key4_flag=0,key5_flag=0;
  219          /*****************æ‹¨ç å¼€å…³åŠæŒ‰é”®åˆå§‹åŒ–*****************
  220          å‡½æ•°ï¼švoid Switch_Key_init()
  221          åŠŸèƒ½ï¼šåˆå§‹åŒ–IO
  222          å‚æ•°ï¼š  æ— 
  223          è¯´æ˜ï¼š åˆå§‹åŒ–IOå£   gpio_init(D1, GPI, GPIO_HIGH, GPI_PULL_UP); GPO_PUSH_PULL
  224          è¿”å›å€¼ï¼šæ— */
  225          void Switch_Key_init()
  226          {
  227   1      
  228   1        //æ‹¨ç å¼€å…³åˆå§‹åŒ–  ï¼ˆæ— éœ€ä¿®æ”¹ï¼Œè¯·å‹¿ä¿®æ”¹ï¼‰
  229   1        SWITCH_INT(Switch_Pin_1) ;
  230   1        SWITCH_INT(Switch_Pin_2) ;
  231   1        SWITCH_INT(Switch_Pin_3) ;
  232   1        SWITCH_INT(Switch_Pin_4) ;
  233   1        SWITCH_INT(Switch_Pin_5) ;
  234   1        SWITCH_INT(Switch_Pin_6) ;
  235   1          
  236   1        //æŒ‰é”®åˆå§‹åŒ– ï¼ˆæ— éœ€ä¿®æ”¹ï¼Œè¯·å‹¿ä¿®æ”¹ï¼‰
  237   1        KEY_INT(KEY1);
  238   1        KEY_INT(KEY2);
  239   1        KEY_INT(KEY3);
  240   1        KEY_INT(KEY4);
  241   1      }
  242          
  243          /*****************æ‹¨ç å¼€å…³ç­–ç•¥é€‰æ‹©*****************
C251 COMPILER V5.60.0,  debug                                                              20/03/25  18:10:41  PAGE 5   

  244          å‡½æ•°ï¼švoid Strategy_Slect()
  245          åŠŸèƒ½ï¼šé€šè¿‡æ‹¨ç å¼€å…³è°ƒæ•´ç­–ç•¥
  246          å‚æ•°ï¼š  æ— 
  247          è¯´æ˜ï¼š  6ä½æ‹¨ç å¼€å…³ï¼Œå¦‚æœæœ‰å¢åŠ æˆ–è€…å‡å°‘å¯å¯¹ç…§ä¿®æ”¹,å¦‚æœä¸è¶³6ä¸ªä¹Ÿä¸è¦åˆ é™¤å
             -¤šä½™çš„ï¼Œå¤šä½™çš„ä½ éšä¾¿å¼•è„šæ”¹ä¸ªæ²¡ç”¨çš„å³å¯
  248                  ä½¿ç”¨ä½ å®šä¹‰çš„å°±å¥½äº†ï¼Œå…¶ä»–æ²¡æœ‰ç”¨åˆ°çš„æ— éœ€å…³å¿ƒ
  249          è¿”å›å€¼ï¼šæ— */
  250          void Strategy_Slect()
  251          {
  252   1            //è¯»å–æ‹¨ç å¼€å…³çŠ¶æ€
  253   1            if(!READ_GPIO(Switch_Pin_1))//ç”¨
  254   1            {
  255   2             Switch1=1;
  256   2      //       //æ˜¾ç¤ºç”µæ„ŸåŸå§‹å€¼
  257   2      //       ips114_showint16(0,0,adc_value[0]);
  258   2      //       ips114_showint16(0,1,adc_value[1]);
  259   2      //       ips114_showint16(0,2,adc_value[2]);
  260   2      //       ips114_showint16(0,3,adc_value[3]);
  261   2      //        
  262   2      //       //æ˜¾ç¤ºç”µæ„Ÿå½’ä¸€åŒ–å€¼
  263   2      //       ips114_showuint8(80,0,Left_Adc);
  264   2      //       ips114_showuint8(80,1,Left_Shu_Adc);
  265   2      //       ips114_showuint8(80,2,Right_Shu_Adc);
  266   2      //       ips114_showuint8(80,3,Right_Adc);
  267   2      //        
  268   2      //       ips114_showfloat(0,5,Current_Dir,2,1);//æ˜¾ç¤ºæµ®ç‚¹æ•°   æ•´æ•°æ˜¾ç¤º2ä½   å°æ•°æ˜¾ç¤º1ä½
  269   2      //        
  270   2      //       ips114_showint16(130,0,left_speed);
  271   2      //       ips114_showint16(130,1,right_speed);
  272   2            }
  273   1            if(!READ_GPIO (Switch_Pin_2))//ç”¨
  274   1            {
  275   2             Switch2=1;
  276   2             Library_selection=2;   //å‡ºåº“é€‰æ‹©ï¼ŒLibrary_selectioné»˜è®¤ä¸º1ï¼Œå·¦å‡ºåº“ï¼Œæ‹¨ä¸‹åå˜æˆ2ï¼Œ
             -å³å‡ºåº“
  277   2            }
  278   1            if(!READ_GPIO (Switch_Pin_3))
  279   1            {
  280   2             Switch3=1;
  281   2             
  282   2            }
  283   1            if(!READ_GPIO (Switch_Pin_4))
  284   1            {
  285   2             Switch4=1;
  286   2      
  287   2            }
  288   1            if(!READ_GPIO (Switch_Pin_5))
  289   1            {
  290   2             Switch5=1;
  291   2      
  292   2            }
  293   1            if(!READ_GPIO (Switch_Pin_6))
  294   1            {
  295   2             Switch6=1;
  296   2       
  297   2            }
  298   1        
  299   1      }
  300          
  301          /*****************æŒ‰é”®æ‰«æè¯»å–*****************
  302          å‡½æ•°ï¼švoid  Key_Scan_Deal ()
  303          åŠŸèƒ½ï¼šè¯»å–æŒ‰é”®å¹¶æ‰§è¡Œå¯¹åº”æ“ä½œ
  304          å‚æ•°ï¼š  æ— 
  305          è¯´æ˜ï¼š å‚è€ƒé€é£ä¾‹ç¨‹ ï¼Œ5ä½æŒ‰é”®ï¼Œå¦‚æœæœ‰å¢åŠ æˆ–è€…å‡å°‘å¯å¯¹ç…§ä¿®æ”¹
  306                // 1å·ä¸ºå·¦ç§»é”®ï¼Œ2å·ä¸ºä¸Šé”®ï¼Œ3å·ä¸ºå³ç§»é”®ï¼Œ4å·ä¸ºä¸­é”®ç›˜ï¼Œ5å·ä¸ºä¸‹é”®
  307               //æœ¬æ¬¡ç¨‹åºæ²¡æœ‰ä½¿ç”¨è°ƒå‚ï¼Œstcå•ç‰‡æœºä¸‹è½½ç¨‹åºä¹Ÿå¿«ï¼Œæ”¹äº†çƒ§å°±å¯ä»¥ï¼Œå¦‚æœè¦åŠ
C251 COMPILER V5.60.0,  debug                                                              20/03/25  18:10:41  PAGE 6   

             - çš„è¯è‡ªå·±æ ¹æ®ä¸‹é¢çš„è‡ªå·±åŠ å°±å¯ä»¥
  308          è¿”å›å€¼ï¼šæ—      */
  309          uint8 gogo=0;
  310          void  Key_Scan_Deal ()
  311          {
  312   1        while(gogo<=2)
  313   1        {
  314   2          //ä½¿ç”¨æ­¤æ–¹æ³•ä¼˜ç‚¹åœ¨äºï¼Œä¸éœ€è¦ä½¿ç”¨while(1) ç­‰å¾…ï¼Œé¿å…å¤„ç†å™¨èµ„æºæµªè´¹
  315   2          //ä¿å­˜æŒ‰é”®çŠ¶æ€
  316   2          key1_last_status = key1_status;
  317   2          key2_last_status = key2_status;
  318   2          key3_last_status = key3_status;
  319   2          key4_last_status = key4_status;
  320   2          //è¯»å–å½“å‰æŒ‰é”®çŠ¶æ€
  321   2          key1_status = READ_GPIO(KEY1);
  322   2          key2_status = READ_GPIO(KEY2);
  323   2          key3_status = READ_GPIO(KEY3);
  324   2          key4_status = READ_GPIO(KEY4);
  325   2          //æ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹ä¹‹å  å¹¶æ”¾å¼€ç½®ä½æ ‡å¿—ä½
  326   2          if(key1_status && !key1_last_status)    key1_flag = 1;
  327   2          if(key2_status && !key2_last_status)    key2_flag = 1;
  328   2          if(key3_status && !key3_last_status)    key3_flag = 1;
  329   2          if(key4_status && !key4_last_status)    key4_flag = 1;
  330   2          if(key5_status && !key5_last_status)    key5_flag = 1;
  331   2          //æ ‡å¿—ä½ç½®ä½ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨æ ‡å¿—ä½æ‰§è¡Œè‡ªå·±æƒ³è¦åšçš„äº‹ä»¶
  332   2       
  333   2          if(key1_flag) //S1é”®ï¼Œå‚æ•°åŠ 
  334   2          {
  335   3            key1_flag = 0;//ä½¿ç”¨æŒ‰é”®ä¹‹åï¼Œåº”è¯¥æ¸…é™¤æ ‡å¿—ä½
  336   3            /*ä»¥ä¸‹ä¸ºç”¨æˆ·ä»»åŠ¡  */
  337   3            switch(parameter)
  338   3            {
  339   4            //-----------------------è°ƒå‚è¯·ä¿®æ”¹ä¸‹é¢--ï¼ˆæ³¨æ„ä¿®æ”¹å¯¹åº”çš„æ˜¾ç¤ºï¼‰------------------
             -----------------------------------------------
  340   4            //ç¬¬ä¸€é¡µæ˜¾ç¤ºçš„ä¸œè¥¿
  341   4              case 0:TurnPID.Kp+=1; break;//extern_iap_write_float(TurnPID.Kp,3,2,0x00);      break;
  342   4              case 1:TurnPID.Ki+=0.1;  break;//extern_iap_write_float(TurnPID.Ki,3,2,0x07);      break;
  343   4              case 2:TurnPID.Kd+=0.1;  break;//extern_iap_write_float(TurnPID.Kd,3,2,0x0e);      break;
  344   4              case 3:;TurnPID.K_gory+=1;  break;
  345   4              case 4:;  break;
  346   4              case 5:;  break;
  347   4            /// case 6:  ; break;//è¿™ä¸ªä¸èƒ½åŠ ä»»ä½•æ“ä½œåœ¨è¿™é‡Œäº†ï¼Œç¿»é¡µä½¿ç”¨å•¦ extern_iap_write_b
             -ytes(0x00,&aim_speed,2);
  348   4            //ç¬¬äºŒé¡µæ˜¾ç¤ºçš„ä¸œè¥¿
  349   4              case 7:SpeedPID.Kp+=1;   break;
  350   4              case 8:SpeedPID.Ki+=0.1; break;
  351   4              case 9:SpeedPID.Kd+=0.1; break;
  352   4              case 10:aim_speed+=10;   break;
  353   4              case 11: break;
  354   4              case 12: break;
  355   4             //--------------------è°ƒå‚è¯·ä¿®æ”¹ä¸Šé¢-------------------------------------------------------
             ------------
  356   4             }
  357   3           }
  358   2           if(key2_flag)//S2é”®ï¼Œå‚æ•°å‡
  359   2           {
  360   3             key2_flag = 0;//ä½¿ç”¨æŒ‰é”®ä¹‹åï¼Œåº”è¯¥æ¸…é™¤æ ‡å¿—ä½
  361   3            /*  ä»¥ä¸‹ä¸ºç”¨æˆ·ä»»åŠ¡  */
  362   3             switch(parameter)
  363   3             {
  364   4             //----------------------è°ƒå‚è¯·ä¿®æ”¹ä¸‹é¢--ï¼ˆæ³¨æ„ä¿®æ”¹å¯¹åº”çš„æ˜¾ç¤ºï¼‰------------------
             ---------------------------------------------
  365   4             //ç¬¬ä¸€é¡µæ˜¾ç¤ºçš„ä¸œè¥¿
  366   4              case 0:TurnPID.Kp-=20;       break;
  367   4              case 1:TurnPID.Ki-=5;        break;
  368   4              case 2:TurnPID.Kd-=5;        break;
C251 COMPILER V5.60.0,  debug                                                              20/03/25  18:10:41  PAGE 7   

  369   4              case 3:;  TurnPID.K_gory-=5;break;
  370   4              case 4:;  break;
  371   4              case 5:;  break;
  372   4              //case 6:ips114_showstr(0,0,"FANYE_ing");  ; break;//è¿™ä¸ªä¸èƒ½åŠ ä»»ä½•æ“ä½œåœ¨è¿™é‡Œäº†ï¼Œç¿
             -»é¡µä½¿ç”¨å•¦
  373   4             //ç¬¬äºŒé¡µæ˜¾ç¤ºçš„ä¸œè¥¿ 
  374   4              case 7:SpeedPID.Kp-=1;   break;
  375   4              case 8:SpeedPID.Ki-=0.1; break;
  376   4              case 9:SpeedPID.Kd-=0.1; break;
  377   4              case 10:aim_speed-=50;   break;
  378   4              case 11: break;
  379   4              case 12: break;
  380   4             //--------------------è°ƒå‚è¯·ä¿®æ”¹ä¸Šé¢-------------------------------------------------------
             ------------
  381   4             } 
  382   3            }
  383   2            if(key3_flag)//S3é”®ï¼Œé€‰æ‹©è°ƒå‚çš„å‚æ•°
  384   2            {
  385   3              key3_flag = 0;//ä½¿ç”¨æŒ‰é”®ä¹‹åï¼Œåº”è¯¥æ¸…é™¤æ ‡å¿—ä½               
  386   3              parameter++;
  387   3              ips114_clear(WHITE);
  388   3              if(parameter>=11) parameter=0;
  389   3            }
  390   2            if(key4_flag)//S4é”®ï¼Œç¡®è®¤æŒ‰é”®ï¼ŒæŒ‰ä¸‰ä¸‹é€€å‡ºè°ƒå‚
  391   2            {
  392   3              key4_flag = 0;//ä½¿ç”¨æŒ‰é”®ä¹‹åï¼Œåº”è¯¥æ¸…é™¤æ ‡å¿—ä½
  393   3              gogo++;
  394   3            }
  395   2          //*******************************å±å¹•æ˜¾ç¤ºç¬¬ä¸€é¡µ***********************
  396   2      
  397   2          if(parameter<6)//æ˜¾ç¤ºå‚æ•°0åˆ°5ï¼Œå®é™…æ˜¾ç¤º1åˆ°6
  398   2          {
  399   3            ips114_showstr(0,parameter+1,"->");
  400   3            ips114_showstr(20,0,"parameter->");    ips114_showint8(150,0,parameter);//xä¸ºint8ç±»å‹
  401   3            //æ˜¾ç¤ºè°ƒå‚è¿‡ç¨‹   è¡Œå·æœ€åä¸€è¡Œä¸º9   åªèƒ½æ˜¾ç¤ºè¿™ä¹ˆå¤šï¼Œæ›´å¤šé‡æ–°ç¿»é¡µæ˜¾ç¤º  ä
             -¸€é¡µè°ƒ6ä¸ªå‚æ•°
  402   3            ips114_showstr(20,1,"TurnPID.Kp=");    ips114_showfloat(150,1,TurnPID.Kp,3,2);//æ˜¾ç¤ºæµ®ç‚¹æ•°  
  403   3            ips114_showstr(20,2,"TurnPID.Ki=");    ips114_showfloat(150,2,TurnPID.Ki,2,2);//æ˜¾ç¤ºæµ®ç‚¹æ•°   
  404   3            ips114_showstr(20,3,"TurnPID.Kd=");    ips114_showfloat(150,3,TurnPID.Kd,2,2);//æ˜¾ç¤ºæµ®ç‚¹æ•°   
  405   3            ips114_showstr(20,4,"TurnPID.K_gory=");      ips114_showint16(150,4,TurnPID.K_gory);
  406   3                  
  407   3          }
  408   2          //*******************************å±å¹•æ˜¾ç¤ºç¬¬äºŒé¡µ***********************************************
             -***
  409   2          if(parameter>6&&parameter<11)//è¿™é‡Œè¡Œå·ä»4åˆ°9   ä¸€é¡µè°ƒ6ä¸ªå‚æ•°  //æ˜¾ç¤ºå‚æ•°7åˆ°5ï¼Œå®é
             -™…æ˜¾ç¤º7åˆ°12
  410   2          {
  411   3            ips114_showstr(0,parameter-6,"->");
  412   3            ips114_showstr(20,0,"parameter->");    ips114_showint8(150,0,parameter);//xä¸ºint8ç±»å‹
  413   3            //æ˜¾ç¤ºè°ƒå‚è¿‡ç¨‹   è¡Œå·æœ€åä¸€è¡Œä¸º9   åªèƒ½æ˜¾ç¤ºè¿™ä¹ˆå¤šï¼Œæ›´å¤šé‡æ–°ç¿»é¡µæ˜¾ç¤º  ä
             -¸€é¡µè°ƒ6ä¸ªå‚æ•°
  414   3            ips114_showstr(20,1,"SpeedPID.Kp=");    ips114_showfloat(150,1,SpeedPID.Kp,2,2);//æ˜¾ç¤ºæµ®ç‚¹æ•°  
  415   3            ips114_showstr(20,2,"SpeedPID.Ki=");    ips114_showfloat(150,2,SpeedPID.Ki,2,2);//æ˜¾ç¤ºæµ®ç‚¹æ•°  
             - 
  416   3            ips114_showstr(20,3,"SpeedPID.Kd=");    ips114_showfloat(150,3,SpeedPID.Kd,2,2);//æ˜¾ç¤ºæµ®ç‚¹æ•°  
             - 
  417   3            ips114_showstr(20,4,"aim_speed=");      ips114_showint16(150,4,aim_speed); 
  418   3      //      ips114_showstr(20,5,"Turn_NeiPID.Ki=");ips114_showfloat(150,5,Turn_NeiPID.Ki,2,2);//æ˜¾ç¤ºæµ®ç‚¹æ•°
             - 
  419   3      //      ips114_showstr(20,6,"Turn_NeiPID.Kd=");ips114_showfloat(150,6,Turn_NeiPID.Kd,2,2);//æ˜¾ç¤ºæµ®ç‚¹æ•°
             -    
  420   3          }
  421   2          //*******************************å±å¹•æ˜¾ç¤ºç¬¬ä¸‰é¡µ***********************************************
             -***
  422   2      //    if(parameter>13&&parameter<20)
  423   2      //    {
C251 COMPILER V5.60.0,  debug                                                              20/03/25  18:10:41  PAGE 8   

  424   2      //                  
  425   2      //    }
  426   2          //###########è¿˜éœ€è¦æ›´å¤šé¡µä»¿ç…§ç€å†™å°±å¯ä»¥å’¯######################è¿™é‡Œå°±ä¸å†™äº† ç»“æ
             -Ÿ
  427   2          if(parameter==6||parameter==13||parameter==20)  //ç¿»é¡µå‡†å¤‡
  428   2          {
  429   3             ips114_showstr(0,0,"Ready to turn the page...");
  430   3             ips114_showstr(0,1,"Press the button to display ");
  431   3             ips114_showstr(0,2,"the second page...");
  432   3            // ips114_clear(WHITE);              
  433   3          }//æ¸…å±
  434   2          if(gogo>2)
  435   2          {
  436   3            ips114_clear(WHITE); 
  437   3          }
  438   2        }
  439   1      }
  440          //===============================================è°ƒè¯•ç¯å²›å±å¹•æ˜¾ç¤º================================
             -=============
  441          //=======================================================================================================
             -=====
  442          /************************************************è°ƒè¯•ç¯å²›å±å¹•æ˜¾ç¤º********************************
             -*************
  443          å‡½æ•°ï¼švoid Roundabout_debugshow(void)
  444          åŠŸèƒ½ï¼šè°ƒè¯•ç¯å²›æ—¶æ˜¾ç¤ºç›¸åº”çš„æ ‡å¿—ä½ï¼Œæ–¹ä¾¿è°ƒè¯•
  445          å‚æ•°ï¼š  æ— 
  446          è¯´æ˜ï¼š
  447          è¿”å›å€¼ï¼šæ—  
  448          *********************************************************************************************************
             -*****/
  449          void Roundabout_debugshow(void)
  450          {
  451   1        ips114_showuint8(0,0,Left_Adc);      //å·¦æ¨ªç”µæ„Ÿå€¼
  452   1        ips114_showuint8(0,1,Left_Shu_Adc);  //å·¦ç«–ç”µæ„Ÿå€¼
  453   1        ips114_showuint8(0,2,Right_Shu_Adc); //å³ç«–ç”µæ„Ÿå€¼
  454   1        ips114_showuint8(0,3,Right_Adc);     //å³æ¨ªç”µæ„Ÿå€¼
  455   1        ips114_showint16(0,4,Left_Adc+Right_Adc);
  456   1        ips114_showint16(0,5,Left_Adc+Right_Adc+Left_Shu_Adc+Right_Shu_Adc);
  457   1      //  ips114_showfloat(0,6,error,2,1);//æ˜¾ç¤ºæµ®ç‚¹æ•°   æ•´æ•°æ˜¾ç¤º2ä½   å°æ•°æ˜¾ç¤º1ä½ 
  458   1      
  459   1      
  460   1        ips114_showint8(50,0,road_type.annulus);           //ç¯å²›æ ‡å¿—ä½
  461   1        ips114_showint8(50,1,road_type.in_annulus_left);   //å·¦ç¯å²›è¿›ç¯æ‰“è§’æ ‡å¿—ä½
  462   1        ips114_showint8(50,2,road_type.in_annulus_right);  //å³ç¯å²›è¿›ç¯æ‰“è§’æ ‡å¿—ä½
  463   1        ips114_showint8(50,3,road_type.on_annulus_left);   //åœ¨å·¦ç¯å²›æ ‡å¿—ä½ï¼ˆè®¤ä¸ºå°è½¦å·²ç»å…¥ç¯ï¼‰
  464   1        ips114_showint8(50,4,road_type.on_annulus_right);  //åœ¨å³ç¯å²›æ ‡å¿—ä½ï¼ˆè®¤ä¸ºå°è½¦å·²ç»å…¥ç¯ï¼‰
  465   1        ips114_showint8(50,5,road_type.out_annulus);      //å‡ºç¯å²›æ ‡å¿—ä½
  466   1        ips114_showint8(50,6,testflag);         //å‡ºç¯å²›æ ‡å¿—ä½
  467   1      //  ips114_showint16(50,7,annulus_t);                     //å‡ºç¯å²›å®šæ—¶æ¸…0æ—¶é—´
  468   1        
  469   1        
  470   1        ips114_showfloat(100,0,annulus_s,4,1);                  //è¿‡ç¯å²›ä¸‰è§’åŒºç¼–ç å™¨ç§¯åˆ†è·ç¦»
  471   1        ips114_showfloat(100,1,annulus_s2,4,1);                  //è¿›ç¯æ‰“è§’é™€èºä»ªç§¯åˆ†è§’åº¦å€¼
  472   1        ips114_showfloat(100,2,GORY_Z,4,1);                 //
  473   1        ips114_showint16(100,3,annulus_t);                  //å‡ºç¯å²›å®šæ—¶æ¸…0æ—¶é—´
  474   1        
  475   1        ips114_showint16(100,4,left_real_speed);
  476   1        ips114_showint16(100,5,right_real_speed);
  477   1        ips114_showint16(100,6,real_speed);
  478   1            
  479   1      //  ips114_showfloat(100,7,testdistance,4,1);
  480   1            
  481   1      //  ips114_showuint8(100,5,road_type.out_annulus);        //å‡ºç¯å²›æ ‡å¿—ä½
  482   1      //  ips114_showint16(100,6,annulus_t);                    //å‡ºç¯å²›å®šæ—¶æ¸…0æ—¶é—´
  483   1      //  ips114_showint16(100,7,testflag);
  484   1      }
C251 COMPILER V5.60.0,  debug                                                              20/03/25  18:10:41  PAGE 9   

  485          
  486          //===============================================è°ƒè¯•é€Ÿåº¦ç¯å¹•æ˜¾ç¤º================================
             -=============
  487          //=======================================================================================================
             -=====
  488          /************************************************è°ƒè¯•é€Ÿåº¦ç¯å¹•æ˜¾ç¤º********************************
             -*************
  489          å‡½æ•°ï¼šSpeed_debugshow(void)
  490          åŠŸèƒ½ï¼šè°ƒè¯•é€Ÿåº¦ç¯æ—¶æ˜¾ç¤ºç›¸åº”å·¦å³ç¼–ç å™¨çš„å€¼ï¼Œæ–¹ä¾¿è°ƒè¯•ï¼ˆé€Ÿåº¦ç¯æ¨èç”¨ä¸Šä½æœº
             -çœ‹æ³¢å½¢è°ƒè¯•ï¼‰
  491          å‚æ•°ï¼š  æ— 
  492          è¯´æ˜ï¼š
  493          è¿”å›å€¼ï¼šæ—  
  494          *********************************************************************************************************
             -*****/
  495          void Speed_debugshow(void)
  496          {
  497   1        ips114_showint16(0,0,left_real_speed);  //å·¦ç¼–ç å™¨çš„å€¼
  498   1        ips114_showint16(0,1,right_real_speed); //å³ç¼–ç å™¨çš„å€¼
  499   1        ips114_showint16(0,2,real_speed);       //å·¦å³è½®å¹³å‡å€¼
  500   1        
  501   1        
  502   1      }
  503          //===============================================èœ‚é¸£å™¨ç›¸å…³=========================================
             -====
  504          //=====================================================================================================
  505          
  506          //èœ‚é¸£å™¨å¼€å’Œå…³ è¢«å†™åœ¨å¯¹åº”å¤´æ–‡ä»¶å»äº†ï¼Œå»Hæ–‡ä»¶æŸ¥çœ‹
  507          
  508          /*****************èœ‚é¸£å™¨æ»´æ»´æ»´*****************
  509          å‡½æ•°ï¼švoid BUZZ_DiDiDi()
  510          åŠŸèƒ½ï¼šèœ‚é¸£å™¨æ»´æ»´æ»´
  511          å‚æ•°ï¼š  æ— 
  512          è¯´æ˜ï¼š
  513          è¿”å›å€¼ï¼šæ—  */
  514          void BUZZ_DiDiDi(uint16 PinLV)
  515          {
  516   1        BUZZ_ON;
  517   1        TiaoCan_DelayMs(PinLV);
  518   1        BUZZ_OFF;
  519   1      }
  520          
  521          
  522          /***************************æµ‹è¯•å®Œæ¯•**********************************************
  523           *  å‡½æ•°åç§°ï¼šTest_Servo(void)
  524           *  åŠŸèƒ½è¯´æ˜ï¼šèˆµæœºPWMåˆå§‹åŒ–ï¼Œæµ‹è¯•æ ‡å®šè¾“å‡ºPWMæ§åˆ¶SD5/S3010èˆµæœº
  525           *  å‚æ•°è¯´æ˜ï¼šæ— 
  526           *  å‡½æ•°è¿”å›ï¼šæ— 
  527           *  ä¿®æ”¹æ—¶é—´ï¼š
  528           *  å¤‡    æ³¨ï¼šå‚è€ƒé¾™é‚±åº“æä¾›çš„ï¼ï¼ï¼ï¼
  529           ã€æ³¨æ„äº‹é¡¹ã€‘æ³¨æ„ï¼Œä¸€å®šè¦å¯¹èˆµæœºæ‰“è§’è¿›è¡Œé™åˆ¶
  530           ä½¿ç”¨é¾™é‚±æ¯æ¿æµ‹è¯•æµç¨‹ï¼š
  531           1.å…ˆä½¿ç”¨ä¸‡ç”¨è¡¨æµ‹é‡ç”µæ± ç”µå‹ï¼ŒåŠ¡å¿…ä¿è¯ç”µæ± ç”µå‹åœ¨7Vä»¥ä¸Šï¼Œå¦åˆ™æ— åŠ›ä¸ååº”ï¼
  532           2.ç„¶åç¡®å®šèˆµæœºä¾›ç”µç”µå‹ï¼ŒSD5èˆµæœºç”¨5Vä¾›ç”µï¼ŒS3010ç”¨6-7Vä¾›ç”µï¼ŒSD012èˆµæœºç”¨5Vä¾›ç”µï¼
             -ï¼ï¼
  533           3.æŠŠèˆµæœºçš„èˆµç›˜å»æ‰ï¼Œè®©èˆµæœºå¯ä»¥è‡ªç”±è½¬åŠ¨ï¼›
  534           4.çƒ§å†™ç¨‹åºå¹¶è¿è¡Œï¼Œè®©èˆµæœºè½¬åŠ¨åˆ°ä¸­å€¼é™„è¿‘ï¼›å¦‚æœæ²¡ååº”é‡å¤1-2æ­¥ï¼Œæˆ–è€…è°ƒæ•´èˆµ
             -æœºçš„PWMé¢‘ç‡è®¡å ç©ºæ¯”ï¼Œèƒ½å—æ§ä¸ºå‡†ï¼›
  535           5.èˆµæœºå—æ§åç”¨æ‰‹è½»è½¬ï¼Œèˆµæœºä¼šå±å±å“ï¼Œå¯¹æŠ—è½¬åŠ¨ï¼Œæ­¤æ—¶å¯ä»¥è£…ä¸Šèˆµç›˜ï¼›
  536           6.æŒ‰é”®K0/K1ç¡®å®šèˆµæœºçš„å·¦å³è½¬åŠ¨æé™ï¼Œå¹¶è®°ä¸‹æ¥ï¼Œä½œä¸ºåç»­é™å¹…é˜²æ­¢èˆµæœºå µè½¬çƒ§æ
             -¯ï¼
  537           *************************************************************************/
  538          //void Test_Servo_Hardware (void)
  539          //{
  540          //    char txt[16] = "X:";
  541          //    unsigned int  duty = Steer_Duty_Midle;
C251 COMPILER V5.60.0,  debug                                                              20/03/25  18:10:41  PAGE 10  

  542          
  543          //    ips114_clear(YELLOW);  //åˆå§‹æ¸…å±
  544          //    ips114_showstr(0, 0, "Test_Servo_Hardware:");
  545          //    pwm_init(Steer_Pin, 50, Steer_Duty_Midle);     //åˆå§‹åŒ–èˆµæœº  è¾“å‡ºPWMé¢‘ç‡200HZï¼Œå¹¶è®¾ç½®ä
             -¸­å€¼
  546          //    pwm_duty(Steer_Pin, Steer_Duty_Midle);
  547          //    while (1)
  548          //    {
  549          //        if (!READ_GPIO(KEY1))
  550          //        {
  551          //            if (duty > 100)     //é˜²æ­¢dutyè¶…
  552          //            {
  553          //                duty += 10;     //æ ‡å®šçš„æ—¶å€™ï¼Œå¯ä»¥æŠŠæ­¥é•¿æ”¹å°ç‚¹ï¼Œæ¯”å¦‚10
  554          //            }
  555          //        }
  556          //        if (! READ_GPIO(KEY3))
  557          //        {
  558          //            duty = Steer_Duty_Midle;
  559          //        }
  560          //        if (! READ_GPIO(KEY2))
  561          //        {
  562          //            duty -= 10;
  563          //        }
  564          //        pwm_duty(Steer_Pin, duty);
  565          //        sprintf(txt, "Servo:%05d ", duty);
  566          //        ips114_showstr(1, 2, txt); //æ˜¾ç¤º
  567          //        TiaoCan_DelayMs(100);        
  568          //    }
  569          //}
  570          
  571          /****************************æµ‹è¯•å®Œæ¯•*********************************************
  572           *  å‡½æ•°åç§°ï¼šTestMotor(void)
  573           *  åŠŸèƒ½è¯´æ˜ï¼šæµ‹è¯•æ ‡å®šè¾“å‡ºPWMæ§åˆ¶ç”µæœº
  574           *  å‚æ•°è¯´æ˜ï¼šæ— 
  575           *  å‡½æ•°è¿”å›ï¼šæ— 
  576           *  ä¿®æ”¹æ—¶é—´ï¼š
  577           *  å¤‡    æ³¨ï¼šé©±åŠ¨2ä¸ªç”µæœº
  578           ã€æ³¨æ„äº‹é¡¹ã€‘æ³¨æ„ï¼Œä¸€å®šè¦å¯¹ç”µæœºè¾“å‡ºè¿›è¡Œé™åˆ¶
  579           ä½¿ç”¨é¾™é‚±æ¯æ¿æµ‹è¯•æµç¨‹ï¼š
  580           1.å…ˆä½¿ç”¨ä¸‡ç”¨è¡¨æµ‹é‡ç”µæ± ç”µå‹ï¼ŒåŠ¡å¿…ä¿è¯ç”µæ± ç”µå‹åœ¨7Vä»¥ä¸Šï¼Œå¦åˆ™æ— åŠ›ä¸ååº”ï¼
  581           2.æ¥å¥½æ¯æ¿åˆ°é©±åŠ¨æ¿çš„ä¿¡å·çº¿åŠç”µæºçº¿ï¼›
  582           3.æ¥å¥½é©±åŠ¨æ¿åˆ°ç”µæœºçš„å¯¼çº¿ï¼›
  583           4.çƒ§å†™ç¨‹åºå¹¶è¿è¡Œï¼Œç¡®å®šç”µæœºèƒ½æ­£å¸¸è½¬åŠ¨åï¼Œå¼€å¯é©±åŠ¨æ¿ç”µæºå¼€å…³ï¼›
  584           5.æŒ‰é”®K0/K1ç¡®å®šç”µæœºè½¬åŠ¨é€Ÿåº¦åŠæ–¹å‘ï¼›
  585           6.å¦‚æœå‡ºç°ç–¯è½¬ï¼ŒæŒ‰ä¸‹K1é”®è¿”å›ä½é€Ÿæ¨¡å¼ï¼Œæˆ–è€…ç›´æ¥å…³é—­é©±åŠ¨æ¿ç”µæºï¼
  586           *************************************************************************/
  587          void Test_Motor_Hardware (void)
  588          {
  589   1          int16 motor_duty = 3000;
  590   1          lcd_clear(YELLOW);  //åˆå§‹æ¸…å±
  591   1          lcd_showstr(2, 0, "Test_Motor_Hardware:");
  592   1          init_PWM(MOTOR_MODE_SELECT);
  593   1        
  594   1          while (1)
  595   1          {
  596   2          if (!READ_GPIO(KEY1))   //æŒ‰ä¸‹KEY1é”®   å·¦è½®å•ç‹¬æ­£è½¬
  597   2              {
  598   3                 go_motor (motor_duty,0);
  599   3                 lcd_showstr(0, 4, "Left  Front");   //å­—ç¬¦ä¸²æ˜¾ç¤º
  600   3              }
  601   2             if (!READ_GPIO(KEY3)) //æŒ‰ä¸‹KEY2é”®ï¼Œå·¦å³è½®åŒæ—¶åè½¬
  602   2              {
  603   3                   go_motor (-motor_duty,-motor_duty);
  604   3                   lcd_showstr(0, 4, "All  Black");   //å­—ç¬¦ä¸²æ˜¾ç¤º
  605   3                       
  606   3              }
C251 COMPILER V5.60.0,  debug                                                              20/03/25  18:10:41  PAGE 11  

  607   2             if (!READ_GPIO(KEY2))      //æŒ‰ä¸‹KEY3é”®  å³è½®å•ç‹¬æ­£è½¬
  608   2              {
  609   3                   go_motor (0,motor_duty);
  610   3                   lcd_showstr(0, 4, "Right Front");   //å­—ç¬¦ä¸²æ˜¾ç¤º
  611   3              }
  612   2              if((READ_GPIO(KEY1))&&(READ_GPIO(KEY2))&&(READ_GPIO(KEY3)))
  613   2              go_motor (0,0);
  614   2              TiaoCan_DelayMs(100);  
  615   2          }
  616   1      }
  617          
  618          /****************************æµ‹è¯•å®Œæ¯•*********************************************
  619           *  å‡½æ•°åç§°ï¼švoid Test_Electric_Hardware (void)
  620           *  åŠŸèƒ½è¯´æ˜ï¼šæµ‹è¯•ç”µç£ç”µæ„Ÿç¡¬ä»¶
  621           *  å‚æ•°è¯´æ˜ï¼šæ— 
  622           *  å‡½æ•°è¿”å›ï¼šæ— 
  623           *  å¤‡    æ³¨ï¼š
  624           ã€æ³¨æ„äº‹é¡¹ã€‘
  625           *************************************************************************/
  626          void Test_Electric_Hardware (void)
  627          {
  628   1        char txt[16];
  629   1        ips114_clear(YELLOW);  //åˆå§‹æ¸…å±
  630   1        ips114_showstr(2, 0, "Test_Electric_Hardware:");
  631   1        ADC_int();
  632   1        while(1)
  633   1        {
  634   2      //        if (!READ_GPIO(KEY1)) //æŒ‰ä¸‹KEY1é”®
  635   2      //        {
  636   2                lcd_showstr(2, 1, "Normalize_Deal....");   //å­—ç¬¦ä¸²æ˜¾ç¤º
  637   2                ADC_Collect();  //ç”µæ„Ÿé‡‡å€¼
  638   2                
  639   2                sprintf(txt,"adc0= %05d",adc_value[0]);
  640   2                lcd_showstr(1, 2, txt); //æ˜¾ç¤º
  641   2                sprintf(txt,"adc1= %05d",adc_value[1]);
  642   2                lcd_showstr(1, 3, txt); //æ˜¾ç¤º
  643   2                sprintf(txt,"adc2= %05d",adc_value[2]);
  644   2                lcd_showstr(1, 4, txt); //æ˜¾ç¤º
  645   2                sprintf(txt,"adc3= %05d",adc_value[3]);
  646   2                lcd_showstr(1, 5, txt); //æ˜¾ç¤º                 
  647   2      //        }
  648   2              if(!READ_GPIO(KEY2)) //æŒ‰ä¸‹KEY2é”®
  649   2              {
  650   3                lcd_showstr(2, 1, "GYH_Normalize_Deal....");   //å­—ç¬¦ä¸²æ˜¾ç¤º
  651   3                ADC_Collect();  //ç”µæ„Ÿé‡‡å€¼
  652   3                Data_current_analyze();  //ç”µæ„Ÿå€¼å½’ä¸€åŒ–å‡½æ•°
  653   3                Current_Dir=Cha_bi_he(Left_Adc,Right_Adc,100);
  654   3                
  655   3                sprintf(txt,"adc0= %05d",Left_Adc);
  656   3                lcd_showstr(1, 2, txt); //æ˜¾ç¤º
  657   3                sprintf(txt,"adc1= %05d",Left_Shu_Adc);
  658   3                lcd_showstr(1, 3, txt); //æ˜¾ç¤º
  659   3                sprintf(txt,"adc2= %05d",Right_Shu_Adc);
  660   3                lcd_showstr(1, 4, txt); //æ˜¾ç¤º
  661   3                sprintf(txt,"adc3= %05d",Right_Adc);
  662   3                lcd_showstr(1, 5, txt); //æ˜¾ç¤º
  663   3                sprintf(txt,"Current_Dir= %05d",Current_Dir);
  664   3                lcd_showstr(1, 6, txt); //æ˜¾ç¤º
  665   3              }
  666   2        } 
  667   1      }
  668          /****************************æµ‹è¯•å®Œæ¯•*********************************************
  669           *  å‡½æ•°åç§°ï¼švoid Test_Encoder(void)
  670           *  åŠŸèƒ½è¯´æ˜ï¼šæµ‹è¯•ç¼–ç å™¨
  671           *  å‚æ•°è¯´æ˜ï¼šæ— 
  672           *  å‡½æ•°è¿”å›ï¼šæ— 
C251 COMPILER V5.60.0,  debug                                                              20/03/25  18:10:41  PAGE 12  

  673           *  ä¿®æ”¹æ—¶é—´ï¼š
  674           *  å¤‡    æ³¨ï¼š
  675           ã€æ³¨æ„äº‹é¡¹ã€‘
  676           *************************************************************************/
  677          void Test_Encoder(void)
  678          {
  679   1         char txt[16];
  680   1         encoder_init();//ç¼–ç å™¨åˆå§‹åŒ–
  681   1         lcd_clear(YELLOW);  //åˆå§‹æ¸…å±
  682   1         lcd_showstr(2, 0, "Test_Encoder:");          
  683   1         while(1)
  684   1         {
  685   2            speed_measure();
  686   2            delay_ms(50);
  687   2            sprintf(txt,"Left_Speed  = %05d",left_speed);
  688   2            lcd_showstr(1, 3, txt); //æ˜¾ç¤º
  689   2            sprintf(txt,"Right_Speed = %05d",right_speed);
  690   2            lcd_showstr(1, 4, txt); //æ˜¾ç¤º
  691   2            sprintf(txt,"Real_Speed = %05d",real_speed);
  692   2            lcd_showstr(1, 5, txt); //æ˜¾ç¤º
  693   2         }
  694   1      }
*** WARNING C183 IN LINE 589 OF ..\USER\src\debug.c: dead assignment eliminated


Module Information          Static   Overlayable
------------------------------------------------
  code size            =      3347     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =        25        156
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =       571     ------
End of Module Information.


C251 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
