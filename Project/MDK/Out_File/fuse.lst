C251 COMPILER V5.60.0,  fuse                                                               20/03/25  18:10:41  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE fuse
OBJECT MODULE PLACED IN .\Out_File\fuse.obj
COMPILER INVOKED BY: D:\Keil_v5\C251\BIN\C251.EXE ..\USER\src\fuse.c XSMALL INTR2 WARNINGLEVEL(3) BROWSE INCDIR(..\..\Li
                    -braries\libraries;..\..\Libraries\seekfree_libraries;..\..\Libraries\seekfree_peripheral;..\CODE;..\USER\inc;..\USER\src
                    -) DEBUG PRINT(.\Out_File\fuse.lst) TABS(2) OBJECT(.\Out_File\fuse.obj) 

stmt  level    source

    1          #include "fuse.h"
    2          #include "math.h"
    3          
    4          PID SpeedPID = {0};
    5          PID L_SpeedPID = {0};
    6          PID R_SpeedPID = {0};
    7          PID TurnPID = {0};
    8          float GORY_Z = 0;
    9          /****************************PIDå‚æ•°åˆå§‹åŒ–**************************************
   10          å‡½æ•°ï¼š  void PID_int(void)
   11          å‚æ•°ï¼š  void
   12          è¯´æ˜ï¼š  PIDæ¯ä¸ªç¯å‚æ•°åˆå§‹åŒ–
   13          è¿”å›å€¼ï¼švoid
   14          ********************************************************************************/
   15          void PID_int(void)
   16          {
   17   1        //  SpeedPID.Kp=50;     //0.6//é€Ÿåº¦ç¯PIDå‚æ•°ï¼ˆDè½¦ç”¨ï¼Œé€Ÿåº¦ç¯2msï¼‰18
   18   1        //  SpeedPID.Ki=10 ;     //0.5                                  2.5
   19   1        //  SpeedPID.Kd=0;
   20   1      
   21   1        L_SpeedPID.Kp = 330; // 4  //å·¦è½®é€Ÿåº¦ç¯PIDå‚æ•°ï¼ˆé€Ÿåº¦ç¯20msï¼‰ï¼ˆ6ï¼‰4.5
   22   1        L_SpeedPID.Ki = 0.7; // 1
   23   1        L_SpeedPID.Kd = 0;
   24   1      
   25   1        R_SpeedPID.Kp = 330; // å³é€Ÿåº¦ç¯PIDå‚æ•°ï¼ˆé€Ÿåº¦ç¯20msï¼‰ï¼ˆ6ï¼‰5.5
   26   1        R_SpeedPID.Ki = 0.7;
   27   1        R_SpeedPID.Kd = 0;
   28   1      
   29   1        //  TurnPID.Kp=0;       //è½¬å‘ç¯PIDå‚æ•°
   30   1        //  TurnPID.Ki=0; //0.08
   31   1        //  TurnPID.Kd=0;
   32   1        //
   33   1        //  TurnPID.Kp=4;       //è½¬å‘ç¯PIDå‚æ•°
   34   1        //  TurnPID.Ki=0; //0.08
   35   1        //  TurnPID.Kd=3;
   36   1        //
   37   1        TurnPID.Kp = 1.3; // è½¬å‘ç¯PIDå‚æ•°
   38   1        TurnPID.Ki = 0;   // 0.08
   39   1        TurnPID.Kd = 0.6;
   40   1      
   41   1        TurnPID.K_gory = 0;
   42   1      }
   43          // void PID_int(void)
   44          //{
   45          //  SpeedPID.Kp=18;     //0.6//é€Ÿåº¦ç¯PIDå‚æ•°ï¼ˆDè½¦ç”¨ï¼Œé€Ÿåº¦ç¯2msï¼‰18
   46          //  SpeedPID.Ki=3 ;     //0.5                                  2.5
   47          //  SpeedPID.Kd=0;
   48          //
   49          //  L_SpeedPID.Kp=4; //4  //å·¦è½®é€Ÿåº¦ç¯PIDå‚æ•°ï¼ˆé€Ÿåº¦ç¯20msï¼‰ï¼ˆ6ï¼‰4.5
   50          //  L_SpeedPID.Ki=0.15;//1
   51          //  L_SpeedPID.Kd=0;
   52          //
   53          //  R_SpeedPID.Kp=4;   //å³é€Ÿåº¦ç¯PIDå‚æ•°ï¼ˆé€Ÿåº¦ç¯20msï¼‰ï¼ˆ6ï¼‰5.5
   54          //  R_SpeedPID.Ki=0.15;
   55          //  R_SpeedPID.Kd=0;
   56          //
   57          //  TurnPID.Kp=87;       //è½¬å‘ç¯PIDå‚æ•°
C251 COMPILER V5.60.0,  fuse                                                               20/03/25  18:10:41  PAGE 2   

   58          //  TurnPID.Ki=0; //0.08
   59          //  TurnPID.Kd=0.4;
   60          //  TurnPID.K_gory=3.5;
   61          // }
   62          //  åˆ«å
   63          static TASK_COMPONENTS TaskComps[] =
   64            {
   65              {0, 1, 1, Motor_output_control}, // è§’é€Ÿåº¦å†…ç¯å’ŒDè½¦é€Ÿåº¦ç¯2ms
   66                               //    {0, 2, 2, Trailing_control},           //è½¬å‘å¤–ç¯10ms
   67                               //    {0, 4, 4, Speed_control},              //Cè½¦é€Ÿåº¦ç¯20ms
   68          };
   69          /**************************************************************************************
   70           * FunctionName   : TaskRemarks()
   71           * Description    : ä»»åŠ¡æ ‡å¿—å¤„ç†
   72           * EntryParameter : None
   73           * ReturnValue    : None
   74           * attention      : ***åœ¨å®šæ—¶å™¨ä¸­æ–­ä¸­è°ƒç”¨æ­¤å‡½æ•°å³å¯***
   75           **************************************************************************************/
   76          void TaskRemarks(void)
   77          {
   78   1        uint8 i;
   79   1        for (i = 0; i < TASKS_MAX; i++) // é€ä¸ªä»»åŠ¡æ—¶é—´å¤„ç†
   80   1        {
   81   2          if (TaskComps[i].Timer) // æ—¶é—´ä¸ä¸º0
   82   2          {
   83   3            TaskComps[i].Timer--;    // å‡å»ä¸€ä¸ªèŠ‚æ‹
   84   3            if (TaskComps[i].Timer == 0) // æ—¶é—´å‡å®Œäº†
   85   3            {
   86   4              TaskComps[i].Timer = TaskComps[i].ItvTime; // æ¢å¤è®¡æ—¶å™¨å€¼ï¼Œä»æ–°ä¸‹ä¸€æ¬¡
   87   4              TaskComps[i].Run = 1;            // ä»»åŠ¡å¯ä»¥è¿è¡Œ
   88   4            }
   89   3          }
   90   2        }
   91   1      }
   92          
   93          /**************************************************************************************
   94           * FunctionName   : TaskProcess()
   95           * Description    : ä»»åŠ¡å¤„ç†|åˆ¤æ–­ä»€ä¹ˆæ—¶å€™è¯¥æ‰§è¡Œé‚£ä¸€ä¸ªä»»åŠ¡
   96           * EntryParameter : None
   97           * ReturnValue    : None
   98           * * attention      : ***æ”¾åœ¨miançš„while(1)å³å¯***
   99           **************************************************************************************/
  100          void TaskProcess(void)
  101          {
  102   1        uint8 i;
  103   1        for (i = 0; i < TASKS_MAX; i++) // é€ä¸ªä»»åŠ¡æ—¶é—´å¤„ç†
  104   1        {
  105   2          if (TaskComps[i].Run) // æ—¶é—´ä¸ä¸º0
  106   2          {
  107   3            TaskComps[i].TaskHook(); // è¿è¡Œä»»åŠ¡
  108   3            TaskComps[i].Run = 0;  // æ ‡å¿—æ¸…0
  109   3          }
  110   2        }
  111   1      }
  112          /****************************è§’é€Ÿåº¦å†…ç¯å’ŒDè½¦é€Ÿåº¦ç¯**************************************
  113          å‡½æ•°ï¼š  void Motor_output_control()
  114          å‚æ•°ï¼š  void
  115          è¯´æ˜ï¼š  è§’é€Ÿåº¦å†…ç¯å’ŒDè½¦é€Ÿåº¦ç¯(Dè½¦/ä¸‰è½®è½¦æ‰ä¼šç”¨)
  116          è¿”å›å€¼ï¼švoid
  117          ***************************************************************************************/
  118          void Motor_output_control()
  119          {
  120   1        //    icm20602_get_gyro();
  121   1        //    GORY_Z=icm20602_gyro_transition (icm20602_gyro_z);// å•ä½ä¸ºÂ°/s
  122   1        speed_measure(); // ç¼–ç å™¨æµ‹é‡,å¾…ä¿®æ­£ç¼–ç å™¨è®¡æ•°å€¼è½¬é€Ÿåº¦çš„å•ä½
  123   1        //    Get_deviation();       //ç”µç£é‡‡é›†å¹¶è·å–èµ›é“åå·®
C251 COMPILER V5.60.0,  fuse                                                               20/03/25  18:10:41  PAGE 3   

  124   1        //    timed_task();          //å®šæ—¶æ“ä½œ
  125   1        ADC_PWM = PID_Turn_DT(&TurnPID, Current_Dir, GORY_Z); // åŠ¨æ€ä½ç½®å¼PID  left_real_speed
  126   1      
  127   1        // å¾…ä¿®æ”¹å·®é€Ÿå‚æ•°
  128   1        Speed_pwm_left += IncPIDCalc(&L_SpeedPID, aim_speed + ADC_PWM, left_real_speed);
  129   1        Speed_pwm_right += IncPIDCalc(&R_SpeedPID, aim_speed - ADC_PWM, right_real_speed);
  130   1      
  131   1        //    Speed_pwm_left =range_protect(Speed_pwm_left,  left_real_speed,  -aim_speed, 2*aim_speed);//å‡é€Ÿé
             -™å¹…ï¼ˆé˜²æ­¢è½®å­åè½¬å¤ªå¤§å¯¼è‡´å‡æœŸæœ›é€Ÿåº¦ï¼‰
  132   1        //    Speed_pwm_right=range_protect(Speed_pwm_right, right_real_speed, -aim_speed, 2*aim_speed);//å‡é€Ÿé
             -™å¹…ï¼ˆé˜²æ­¢è½®å­åè½¬å¤ªå¤§å¯¼è‡´å‡æœŸæœ›é€Ÿåº¦ï¼‰
  133   1        //    if(Speed_pwm_left<-aim_speed)
  134   1        //    {
  135   1        //    Speed_pwm_left=-aim_speed;
  136   1        //    }
  137   1        //    if(Speed_pwm_right<-aim_speed)
  138   1        //    {
  139   1        //    Speed_pwm_right=-aim_speed;
  140   1        //    }
  141   1        //    All_PWM_left  = Speed_pwm_all+ADC_PWM;
  142   1        //    All_PWM_right = Speed_pwm_all-ADC_PWM;
  143   1        go_motor(Speed_pwm_left, Speed_pwm_right); // åŠ¨åŠ›è¾“å‡º
  144   1        Out_protect();                 // å‡ºç•Œä¿æŠ¤
  145   1        // P52=1;
  146   1      }
  147          /****************************è½¬å‘ç¯ï¼ˆDè½¦è½¬å‘å¤–ç¯ï¼‰**************************************
  148          å‡½æ•°ï¼š  void Trailing_control()
  149          å‚æ•°ï¼š  void
  150          è¯´æ˜ï¼š  è½¬å‘ç¯ï¼ˆDè½¦è½¬å‘å¤–ç¯ï¼‰ï¼ˆCè½¦è½¬å‘ç¯ï¼‰
  151          è¿”å›å€¼ï¼švoid
  152          ***************************************************************************************/
  153          void Trailing_control()
  154          {
  155   1        //  Get_deviation();  //ç”µç£é‡‡é›†å¹¶è·å–èµ›é“åå·®
  156   1        //  speed_measure();       //ç¼–ç å™¨æµ‹é‡
  157   1        //
  158   1        //  ADC_PWM = LocP_DCalc(&TurnPID,Current_Dir,0);//ä½ç½®å¼PDæ§åˆ¶è½¬å‘
  159   1        ////  Out_protect();         //å‡ºç•Œä¿æŠ¤
  160   1        //  ADC_PWM = PlacePID_Control(&TurnPID,Current_Dir,0);//åŠ¨æ€ä½ç½®å¼PIDæ§åˆ¶
  161   1        //  ADC_PWM = PlacePID_Control(&TurnPID,Current_Dir,0);//åŠ¨æ€ä½ç½®å¼PIDæ§åˆ¶ (ç”¨äºè½¬å‘æ§åˆ¶)
  162   1        // Steering_Control_Out(ADC_PWM);//(Cè½¦ç”¨æ§åˆ¶èˆµæœºè½¬å‘)
  163   1      }
  164          /****************************é€Ÿåº¦ç¯ï¼ˆCè½¦ç”¨ï¼‰**************************************
  165          å‡½æ•°ï¼š  void Speed_control()
  166          å‚æ•°ï¼š  void
  167          è¯´æ˜ï¼š  é€Ÿåº¦ç¯ï¼ˆCè½¦ç”¨ï¼‰
  168          ***************************************************************************************/
  169          void Speed_control()
  170          {
  171   1        // timed_task();           //å‡ºåº“å®šæ—¶æ‰“å¼€å¹²ç°§ç®¡ç­‰
  172   1        // speed_measure();      //ç¼–ç å™¨æµ‹é‡
  173   1        // aim_speed = 450;      //ç›®æ ‡é€Ÿåº¦
  174   1      
  175   1        // Speed_pwm_all = LocP_DCalc(&SpeedPID,aim_speed ,real_speed); //Dè½¦é€Ÿåº¦ç¯ï¼ˆä½ç½®å¼ï¼‰
  176   1        // Speed_pwm_all += IncPIDCalc(&SpeedPID,aim_speed,real_speed);//Dè½¦é€Ÿåº¦ç¯ï¼ˆå¢é‡å¼ï¼‰
  177   1      
  178   1        // Speed_pwm_left += IncPIDCalc(&L_SpeedPID,aim_speed , left_speed); //Cè½¦å·¦è½®é€Ÿåº¦ç¯ï¼ˆä½ç½®å¼ï¼
             -‰
  179   1        // Speed_pwm_right += IncPIDCalc(&R_SpeedPID, aim_speed, right_speed); //Cè½¦å³è½®é€Ÿåº¦ç¯ï¼ˆä½ç½®å¼
             -ï¼‰
  180   1        // go_motor(Speed_pwm_left,Speed_pwm_right);                         //åŠ¨åŠ›è¾“å‡º
  181   1      }
  182          /***************************************************************************************
  183          å‡½æ•°åï¼šint16 range_protect(int16 duty, int16 min, int16 max)
  184          åŠŸ  èƒ½ï¼šé™å¹…ä¿æŠ¤
  185          å‚  æ•°ï¼š
C251 COMPILER V5.60.0,  fuse                                                               20/03/25  18:10:41  PAGE 4   

  186          è¿”å›å€¼ï¼šduty
  187          **************************************************************************************/
  188          // int16 range_protect(int16 input, int16 min, int16 max)//é™å¹…ä¿æŠ¤
  189          //{
  190          
  191          //}


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       286     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =       121     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =       145     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
